<p-toolbar>
  <div #parkHeader class="park-header">
    <button pButton pRipple (click)="goAreas()" label="Go Areas"></button>

    <app-time-range
      (onChange)="timeRangeChange($event)"
      [enabled]="selectedArea.reservationsEnabled"
      [minDate]="minDate"
      [maxDate]="maxDate"
      >
    </app-time-range>

  </div>

  <app-user-avatar
    class="p-toolbar-group-right"
    >
  </app-user-avatar>
</p-toolbar>

<app-area-template
  #parkTemplate
  [parkArea]="selectedArea"
  (spaceClicked)="spaceClicked($event)"
></app-area-template>

<p-dialog
  #cd
  [modal]="true"
  [breakpoints]="{'960px': '75vw', '640px': '100vw'}"
  [closeOnEscape]="true"
  [closable]="true"
  [(visible)]="!!dialogVisible"
  [resizable]="false"
  [maximizable]="true"
  [draggable]="false"
  [style]="{width: '60vw',height: '100vh'}"
  >
  <ng-template pTemplate="header">
    <div>
      <h3>{{selectedSpace.name}}</h3>
      <h4>{{selectedSpace.status}}</h4>
    </div>
  </ng-template>

  <ng-template pTemplate="body">
    <div class="card">
      <p-table
        #resTable
        [value]="reservationsOfDay"
        responsiveLayout="stack"
        breakpoint="960px"
        [autoLayout]="true"
        >
        <ng-template pTemplate="caption">
          <p-tabMenu
            [model]="weekDays"
            [scrollable]="true"
            [activeItem]="weekDays[0]"
            >
            <ng-template
              pTemplate="item"
              let-item
              let-i="index"
              >
              {{item.label}}
            </ng-template>
          </p-tabMenu>
        </ng-template>

        <ng-template pTemplate="header" >
          <tr>
            <th>
              Username
            </th>
            <th>
              Start Time
            </th>
            <th>
              End Time
            </th>
            <th>
              Status
            </th>
          </tr>
        </ng-template>

        <ng-template
          pTemplate="body"
          let-reservation
          let-rowIndex="rowIndex">
          <tr [ngStyle]="{'background-color': reservation.isReserved ? 'rgba(255, 153, 51, 0.125)' : 'rgba(0, 255, 0, 0.125)'}">
            <td>
              <span class="p-column-title">Username</span>
              {{reservation.username}}
            </td>
            <td>
              <span class="p-column-title">Start Time</span>
              {{reservation.startTime | date :
                rowIndex == 0 || rowIndex == reservationsOfDay.length-1
                ? "HH:mm EEEE"
                : "HH:mm"}}
            </td>
            <td>
              <span class="p-column-title">End Time</span>
              {{reservation.endTime | date :
                rowIndex == 0 || rowIndex == reservationsOfDay.length-1
                ? "HH:mm EEEE"
                : "HH:mm"}}
            </td>
            <td>
              <span class="p-column-title">Status</span>
              {{reservation.isReserved ? "Reserved" : "Available"}}
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5">No reservations found.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </ng-template>

  <ng-template pTemplate="footer" >
    <div class="mt-3">
      <p-button type="button" icon="pi pi-calendar" label="Reserve" (onClick)="reserveSpace()" [disabled]="selectedSpace.status == 'occupied' || selectedSpace.isReserved"></p-button>
      <p-button type="button" icon="pi pi-times" label="Close" [styleClass]="'pi-button-error'" (onClick)="dialogVisible = false"></p-button>
    </div>
  </ng-template>
</p-dialog>

<p-toast></p-toast>

<p-confirmDialog [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}">
  Content
</p-confirmDialog>

